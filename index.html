<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AIML CLUB ‚Äî Points Reconciliation</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --primary: #1e40af;
      --primary-light: #3b82f6;
      --secondary: #64748b;
      --accent: #0f62fe;
      --success: #059669;
      --warning: #d97706;
      --error: #dc2626;
      --muted: #6b7280;
      --card: #ffffff;
      --bg: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      --shadow: 0 10px 40px rgba(15,22,39,0.08);
      --shadow-lg: 0 20px 60px rgba(15,22,39,0.12);
      --border: #e2e8f0;
      --border-light: #f1f5f9;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      margin: 0;
      background: var(--bg);
      color: #0f172a;
      padding: 32px;
      line-height: 1.6;
      font-weight: 400;
    }
    
    .wrap {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 440px 1fr;
      gap: 32px;
      align-items: start;
    }
    
    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border-light);
    }
    
    .header-section {
      text-align: center;
      margin-bottom: 24px;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--border-light);
    }
    
    .club-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary);
      margin: 0 0 4px 0;
      letter-spacing: -0.025em;
    }
    
    .subtitle {
      color: var(--muted);
      font-size: 14px;
      font-weight: 500;
    }
    
    .president-info {
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
      padding: 12px 16px;
      border-radius: 10px;
      margin-top: 12px;
      font-size: 13px;
      color: var(--secondary);
    }
    
    h1 {
      font-size: 20px;
      margin: 0 0 8px 0;
      color: var(--primary);
      font-weight: 600;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      font-size: 14px;
      color: var(--secondary);
      margin-bottom: 6px;
      font-weight: 500;
    }
    
    input, textarea, select {
      width: 100%;
      padding: 12px 16px;
      border-radius: 10px;
      border: 2px solid var(--border);
      font-size: 14px;
      transition: all 0.2s ease;
      background: #fafbfc;
    }
    
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--primary-light);
      background: white;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .help-text {
      color: var(--muted);
      font-size: 12px;
      margin-top: 4px;
      line-height: 1.4;
    }
    
    .btn {
      background: var(--primary);
      color: white;
      border: 0;
      padding: 12px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn:hover {
      background: var(--primary-light);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(30, 64, 175, 0.3);
    }
    
    .btn.secondary {
      background: transparent;
      color: var(--primary);
      border: 2px solid var(--primary);
    }
    
    .btn.secondary:hover {
      background: var(--primary);
      color: white;
    }
    
    .controls {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 20px;
    }
    
    .summary {
      display: grid;
      gap: 8px;
      margin-top: 20px;
    }
    
    .summary-item {
      display: flex;
      justify-content: space-between;
      padding: 12px 16px;
      border-radius: 10px;
      background: #f8fafc;
      font-size: 14px;
      border-left: 4px solid var(--border);
    }
    
    .summary-item.highlight {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-left-color: var(--warning);
      font-weight: 600;
    }
    
    .summary-item.success {
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
      border-left-color: var(--success);
    }
    
    .summary-item.error {
      background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
      border-left-color: var(--error);
      color: var(--error);
      font-weight: 600;
    }
    
    /* Invoice Styles */
    .invoice-wrap {
      padding: 32px;
      background: white;
      border-radius: 16px;
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--border);
    }
    
    .invoice-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 24px;
      margin-bottom: 32px;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--border-light);
    }
    
    .logo-section {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .logo-section img {
      height: 64px;
      width: 64px;
      border-radius: 12px;
      object-fit: cover;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .company-info h2 {
      font-size: 22px;
      font-weight: 700;
      color: var(--primary);
      margin: 0 0 4px 0;
      letter-spacing: -0.025em;
    }
    
    .company-info .tagline {
      font-size: 14px;
      color: var(--muted);
      font-weight: 500;
    }
    
    .invoice-meta {
      text-align: right;
      font-size: 13px;
      color: var(--secondary);
    }
    
    .invoice-meta div {
      margin-bottom: 4px;
    }
    
    .client-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 32px;
      padding: 20px;
      background: #f8fafc;
      border-radius: 12px;
      border: 1px solid var(--border-light);
    }
    
    .info-block h4 {
      font-size: 12px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin: 0 0 8px 0;
      font-weight: 600;
    }
    
    .info-block p {
      font-size: 14px;
      font-weight: 600;
      color: var(--secondary);
      margin: 0 0 12px 0;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 24px 0;
      font-size: 14px;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    th, td {
      padding: 16px;
      text-align: left;
      border-bottom: 1px solid var(--border-light);
    }
    
    th {
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
      font-weight: 600;
      color: var(--secondary);
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.025em;
    }
    
    .text-right {
      text-align: right;
    }
    
    .table-total {
      background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
      font-weight: 700;
      color: var(--primary);
    }
    
    .reconcile-status {
      margin: 24px 0;
      padding: 20px;
      border-radius: 12px;
      font-size: 14px;
      line-height: 1.5;
    }
    
    .status-success {
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
      border: 1px solid #10b981;
      color: #065f46;
    }
    
    .status-warning {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border: 1px solid #f59e0b;
      color: #92400e;
    }
    
    .status-error {
      background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
      border: 1px solid #ef4444;
      color: #991b1b;
    }
    
    .notice-box {
      margin: 24px 0;
      padding: 20px;
      border: 2px solid #fca5a5;
      border-radius: 12px;
      background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
      color: #7f1d1d;
      font-size: 14px;
      line-height: 1.6;
    }
    
    .notice-box strong {
      color: #991b1b;
    }
    
    .footer-info {
      margin-top: 32px;
      padding-top: 20px;
      border-top: 2px dashed var(--border);
      font-size: 13px;
      color: var(--muted);
      text-align: center;
      line-height: 1.5;
    }
    
    .action-buttons {
      display: flex;
      gap: 12px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    
    /* Print Styles */
    @media print {
      body {
        background: white !important;
        padding: 0 !important;
        font-size: 12px !important;
      }
      
      .wrap {
        display: block !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 0 !important;
      }
      
      .card:first-child {
        display: none !important;
      }
      
      .invoice-wrap {
        box-shadow: none !important;
        border: none !important;
        padding: 20px !important;
        margin: 0 !important;
      }
      
      .logo-section img {
        height: 48px !important;
        width: 48px !important;
        max-width: 48px !important;
        max-height: 48px !important;
      }
      
      .company-info h2 {
        font-size: 18px !important;
      }
      
      .action-buttons {
        display: none !important;
      }
      
      .invoice-header {
        margin-bottom: 20px !important;
      }
      
      .client-info {
        margin-bottom: 20px !important;
        padding: 15px !important;
      }
      
      table {
        margin: 15px 0 !important;
      }
      
      th, td {
        padding: 10px !important;
      }
      
      .reconcile-status {
        margin: 15px 0 !important;
        padding: 15px !important;
      }
      
      .notice-box {
        margin: 15px 0 !important;
        padding: 15px !important;
      }
      
      .footer-info {
        margin-top: 20px !important;
        padding-top: 15px !important;
      }
    }
    
    /* Responsive Design */
    @media (max-width: 1024px) {
      .wrap {
        grid-template-columns: 1fr;
        padding: 20px;
        gap: 24px;
      }
      
      .card {
        padding: 20px;
      }
      
      .invoice-wrap {
        padding: 24px;
      }
    }
    
    @media (max-width: 768px) {
      body {
        padding: 16px;
      }
      
      .invoice-header {
        flex-direction: column;
        text-align: center;
        gap: 16px;
      }
      
      .client-info {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      .controls {
        flex-direction: column;
      }
      
      .btn {
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Left side: inputs -->
    <div class="card">
      <div class="header-section">
        <div class="club-title">AIML CLUB</div>
        <div class="subtitle">Points Reconciliation System</div>
        <div class="president-info">
          <strong>President:</strong> Mahesh Chitikeshi<br>
          <strong>Contact:</strong> aiml.club@sru.edu.in
        </div>
      </div>

      <div class="form-group">
        <label for="name">Full Name</label>
        <input id="name" placeholder="Enter your full name" value="Mahesh Chitikeshi">
      </div>

      <div class="form-group">
        <label for="hall">Hall Ticket Number</label>
        <input id="hall" placeholder="Enter hall ticket number" value="SRU123456">
      </div>

      <div class="form-group">
        <label for="email">Email Address</label>
        <input id="email" type="email" placeholder="Enter your email" value="mahesh@example.com">
      </div>

      <div class="form-group">
        <label for="loginDate">Login Date</label>
        <input id="loginDate" type="date" />
        <div class="help-text">Select the date when you first joined the club</div>
      </div>

      <div class="form-group">
        <label for="currentCoins">Current Total Coins</label>
        <input id="currentCoins" type="number" min="0" value="1000" />
        <div class="help-text">Enter your current coin balance</div>
      </div>

      <div class="form-group">
        <label for="extras">Extra Points (Optional)</label>
        <input id="extras" placeholder="50,60,70">
        <div class="help-text">Enter comma-separated values for additional points earned</div>
      </div>

      <div class="form-group">
        <label for="reason">Reason for Extra Points</label>
        <input id="reason" placeholder="Hackathon prize, Event participation, etc.">
        <div class="help-text">Describe why you received extra points</div>
      </div>

      <div class="controls">
        <button id="computeBtn" class="btn">
          <span>üìä</span> Compute & Preview
        </button>
        <button id="applyBtn" class="btn secondary">
          <span>‚öñÔ∏è</span> Apply Deduction
        </button>
      </div>

      <div id="summaryBox" class="summary"></div>
    </div>

    <!-- Right side: invoice preview & download -->
    <div>
      <div id="invoiceWrap" class="invoice-wrap card" style="display:none">
        <div id="invoiceContent">
          <div class="invoice-header">
            <div class="logo-section">
              <img id="clubLogo" src="Club Logo.png" alt="AIML CLUB Logo">
              <div class="company-info">
                <h2>AIML CLUB</h2>
                <div class="tagline">Points Reconciliation Statement</div>
              </div>
            </div>

            <div class="invoice-meta">
              <div id="invId"><strong>Invoice ID:</strong> ‚Äî</div>
              <div id="invDate"><strong>Date:</strong> ‚Äî</div>
              <div style="margin-top: 8px; color: var(--muted);">
                <strong>Status:</strong> <span id="statusBadge">Processing</span>
              </div>
            </div>
          </div>

          <div class="client-info">
            <div class="info-block">
              <h4>Student Information</h4>
              <p id="pName">‚Äî</p>
              <p><strong>Hall Ticket:</strong> <span id="pHall">‚Äî</span></p>
              <p><strong>Email:</strong> <span id="pEmail">‚Äî</span></p>
            </div>
            <div class="info-block">
              <h4>Timeline</h4>
              <p><strong>Login Date:</strong> <span id="pLogin">‚Äî</span></p>
              <p><strong>Current Date:</strong> <span id="pToday">‚Äî</span></p>
              <p><strong>Days Active:</strong> <span id="pDays">‚Äî</span></p>
            </div>
          </div>

          <table>
            <thead>
              <tr>
                <th>Description</th>
                <th class="text-right">Points</th>
              </tr>
            </thead>
            <tbody id="itemsBody"></tbody>
            <tfoot>
              <tr class="table-total">
                <th>Maximum Allowed Total</th>
                <th id="allowedTotal" class="text-right">‚Äî</th>
              </tr>
            </tfoot>
          </table>

          <div id="reconcileStatus" class="reconcile-status">
            <div id="reconcileText">‚Äî</div>
          </div>

          <div id="deductionNotice" class="notice-box" style="display:none">
            <strong>‚ö†Ô∏è Deduction Applied</strong><br><br>
            Your coins have been <strong>deducted</strong> because there were multiple check-in rewards
            recorded on the same day. This is considered a system glitch and unfair to other members.<br><br>
            We are currently reviewing this issue. Please don't be disappointed ‚Äî you can earn more points
            by actively participating in AIML Club activities and events.<br><br>
            If you believe this calculation is incorrect, please review the invoice details and contact
            President Mahesh Chitikeshi for clarification.<br><br>
            <strong>Contact:</strong> <a href="mailto:aiml.club@sru.edu.in">aiml.club@sru.edu.in</a>
          </div>

          <div class="footer-info">
            <strong>AIML CLUB</strong> ‚Äî Artificial Intelligence & Machine Learning Club<br>
            <strong>President:</strong> Mahesh Chitikeshi<br>
            <strong>Email:</strong> <a href="mailto:aiml.club@sru.edu.in">aiml.club@sru.edu.in</a><br>
            <em>This is an automated system-generated statement</em>
          </div>
        </div>
      </div>

      <div class="action-buttons">
        <button id="downloadPdfBtn" class="btn" style="display:none">
          <span>üìÑ</span> Download PDF
        </button>
        <button id="printBtn" class="btn secondary" style="display:none">
          <span>üñ®Ô∏è</span> Print Invoice
        </button>
      </div>
    </div>
  </div>

  <!-- html2canvas + jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    (function(){
      const DEFAULT_POINTS = 200;
      const PER_DAY_POINTS = 10;

      const loginDateInput = document.getElementById('loginDate');
      const currentCoinsInput = document.getElementById('currentCoins');
      const extrasInput = document.getElementById('extras');
      const nameInput = document.getElementById('name');
      const hallInput = document.getElementById('hall');
      const emailInput = document.getElementById('email');
      const reasonInput = document.getElementById('reason');

      const computeBtn = document.getElementById('computeBtn');
      const applyBtn = document.getElementById('applyBtn');
      const summaryBox = document.getElementById('summaryBox');

      const invoiceWrap = document.getElementById('invoiceWrap');
      const invIdEl = document.getElementById('invId');
      const invDateEl = document.getElementById('invDate');
      const statusBadge = document.getElementById('statusBadge');
      const pName = document.getElementById('pName');
      const pHall = document.getElementById('pHall');
      const pEmail = document.getElementById('pEmail');
      const pLogin = document.getElementById('pLogin');
      const pToday = document.getElementById('pToday');
      const pDays = document.getElementById('pDays');
      const itemsBody = document.getElementById('itemsBody');
      const allowedTotalEl = document.getElementById('allowedTotal');
      const reconcileStatus = document.getElementById('reconcileStatus');
      const reconcileText = document.getElementById('reconcileText');
      const deductionNotice = document.getElementById('deductionNotice');

      const downloadPdfBtn = document.getElementById('downloadPdfBtn');
      const printBtn = document.getElementById('printBtn');

      function formatDate(d){
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        return d.toLocaleDateString('en-US', options);
      }
      
      function daysBetween(start,end){
        return Math.floor((end-start)/(1000*60*60*24));
      }
      
      function parseExtras(text){
        if(!text) return [];
        return text.split(',').map(s=>+s.trim()).filter(n=>!isNaN(n)&&n>0);
      }

      function createSummaryItem(label, value, type = '') {
        const div = document.createElement('div');
        div.className = `summary-item ${type}`;
        div.innerHTML = `<div>${label}</div><div><strong>${value}</strong></div>`;
        return div;
      }

      async function computeAndRender({applyNormalization=false}={}){
        const loginDate = loginDateInput.value ? new Date(loginDateInput.value) : null;
        if(!loginDate){ 
          alert('Please enter a valid login date'); 
          return; 
        }
        
        const today = new Date();
        if(today < loginDate){ 
          alert('Login date cannot be in the future'); 
          return; 
        }

        const name = nameInput.value.trim();
        const hall = hallInput.value.trim();
        const email = emailInput.value.trim();
        
        if(!name || !hall) {
          alert('Please fill in all required fields');
          return;
        }
        
        let currentCoins = +currentCoinsInput.value || 0;

        const days = daysBetween(loginDate,today);
        const earned = days * PER_DAY_POINTS;
        let baseMax = DEFAULT_POINTS + earned;

        const extrasArr = parseExtras(extrasInput.value);
        const extraSum = extrasArr.reduce((a,b)=>a+b,0);
        const adjustedMax = baseMax + extraSum;

        let difference = currentCoins - adjustedMax;
        let deduction = difference>0?difference:0;
        let normalized = currentCoins - deduction;

        if(applyNormalization && deduction>0){
          currentCoins = normalized;
          currentCoinsInput.value = normalized;
        }

        // Update summary
        summaryBox.innerHTML='';
        summaryBox.appendChild(createSummaryItem('Default Points', DEFAULT_POINTS));
        summaryBox.appendChild(createSummaryItem('Days Active', days));
        summaryBox.appendChild(createSummaryItem('Earned Points', earned));
        summaryBox.appendChild(createSummaryItem('Base Maximum', baseMax));
        if(extraSum > 0) {
          summaryBox.appendChild(createSummaryItem('Extra Points', extraSum, 'highlight'));
        }
        summaryBox.appendChild(createSummaryItem('Adjusted Maximum', adjustedMax, 'success'));
        summaryBox.appendChild(createSummaryItem('Current Coins', currentCoins));
        if(deduction > 0) {
          summaryBox.appendChild(createSummaryItem('Deduction Required', deduction, 'error'));
          summaryBox.appendChild(createSummaryItem('Normalized Coins', normalized, 'success'));
        }

        // Update invoice
        const invoiceId = 'INV-' + Date.now();
        invIdEl.innerHTML = `<strong>Invoice ID:</strong> ${invoiceId}`;
        invDateEl.innerHTML = `<strong>Date:</strong> ${formatDate(today)}`;
        
        pName.textContent = name;
        pHall.textContent = hall;
        pEmail.textContent = email;
        pLogin.textContent = formatDate(loginDate);
        pToday.textContent = formatDate(today);
        pDays.textContent = days;

        // Update status badge
        if(deduction > 0) {
          statusBadge.textContent = 'Deduction Applied';
          statusBadge.style.color = 'var(--error)';
        } else {
          statusBadge.textContent = 'Verified';
          statusBadge.style.color = 'var(--success)';
        }

        // Update table
        itemsBody.innerHTML='';
        const items = [
          {desc:'Default Points', amt:DEFAULT_POINTS},
          {desc:`Daily Earned Points (${days} days √ó ${PER_DAY_POINTS})`, amt:earned},
          {desc:'Base Maximum Allowed', amt:baseMax}
        ];
        
        extrasArr.forEach((v,i) => {
          const reason = reasonInput.value || `Extra Points #${i+1}`;
          items.push({desc: reason, amt: v});
        });
        
        items.push(
          {desc:'<strong>Adjusted Maximum Total</strong>', amt:`<strong>${adjustedMax}</strong>`},
          {desc:'Current Coins Balance', amt:currentCoins}
        );
        
        if(deduction > 0) {
          items.push(
            {desc:'<span style="color: var(--error)">Deduction Applied</span>', amt:`<span style="color: var(--error)">${deduction}</span>`},
            {desc:'<span style="color: var(--success)">Final Balance</span>', amt:`<span style="color: var(--success)">${normalized}</span>`}
          );
        }

        items.forEach(item => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${item.desc}</td><td class="text-right">${item.amt}</td>`;
          itemsBody.appendChild(tr);
        });
        
        allowedTotalEl.textContent = adjustedMax;

        // Update reconciliation status
        if(deduction > 0) {
          reconcileStatus.className = 'reconcile-status status-error';
          reconcileText.innerHTML = `<strong>‚ö†Ô∏è Over Limit:</strong> Your current balance exceeds the allowed maximum by <strong>${deduction} points</strong>. Deduction has been applied to normalize your account.`;
          deductionNotice.style.display = 'block';
        } else if(difference === 0) {
          reconcileStatus.className = 'reconcile-status status-success';
          reconcileText.innerHTML = `<strong>‚úÖ Perfect Balance:</strong> Your coins exactly match the allowed maximum of <strong>${adjustedMax} points</strong>.`;
          deductionNotice.style.display = 'none';
        } else {
          reconcileStatus.className = 'reconcile-status status-success';
          reconcileText.innerHTML = `<strong>‚úÖ Within Limit:</strong> You are <strong>${Math.abs(difference)} points</strong> below the maximum allowed. Your account is in good standing.`;
          deductionNotice.style.display = 'none';
        }

        invoiceWrap.style.display = 'block';
        downloadPdfBtn.style.display = 'inline-flex';
        printBtn.style.display = 'inline-flex';
      }

      computeBtn.addEventListener('click', () => computeAndRender());
      applyBtn.addEventListener('click', () => computeAndRender({applyNormalization: true}));

      downloadPdfBtn.addEventListener('click', async () => {
        const content = document.getElementById('invoiceContent');
        
        try {
          const canvas = await html2canvas(content, {
            scale: 2,
            useCORS: true,
            allowTaint: true,
            scrollY: -window.scrollY,
            width: content.scrollWidth,
            height: content.scrollHeight
          });
          
          const imgData = canvas.toDataURL('image/png');
          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF({
            orientation: 'portrait',
            unit: 'pt',
            format: 'a4'
          });
          
          const pageWidth = pdf.internal.pageSize.getWidth();
          const pageHeight = pdf.internal.pageSize.getHeight();
          const margin = 40;
          const contentWidth = pageWidth - (margin * 2);
          const contentHeight = (canvas.height * contentWidth) / canvas.width;
          
          if (contentHeight <= pageHeight - (margin * 2)) {
            pdf.addImage(imgData, 'PNG', margin, margin, contentWidth, contentHeight);
          } else {
            // Handle multiple pages if content is too long
            let yPosition = margin;
            const pageContentHeight = pageHeight - (margin * 2);
            const ratio = contentWidth / canvas.width;
            const scaledHeight = canvas.height * ratio;
            
            pdf.addImage(imgData, 'PNG', margin, yPosition, contentWidth, scaledHeight);
          }
          
          const fileName = `AIML_Club_Invoice_${Date.now()}.pdf`;
          pdf.save(fileName);
        } catch (error) {
          console.error('Error generating PDF:', error);
          alert('Error generating PDF. Please try again.');
        }
      });

      printBtn.addEventListener('click', () => {
        window.print();
      });

      // Set default date to a reasonable past date
      const defaultDate = new Date();
      defaultDate.setMonth(defaultDate.getMonth() - 3); // 3 months ago
      loginDateInput.value = defaultDate.toISOString().split('T')[0];
    })();
  </script>
</body>
</html>